# --- GENERAL SETTINGS ---
set -g default-command "/bin/zsh -l"
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -g mouse on
set -g status-interval 1
set -g escape-time 0
set -g history-limit 10000

# Force the tmux prefix to Ctrl-b
set -g prefix C-b
bind-key C-b send-prefix

# --- THEME / UI (High Contrast B&W) ---
set -g status off
set -g status-position bottom
set -g status-style "bg=#ffffff,fg=#000000"

# Left status: Empty (Isolation is visual via panes)
set -g status-left ""
set -g status-left-length 0

# Window Status (The "Tabs")
set -g window-status-separator " "
set -g window-status-format "#[fg=#999999] #I:#W "
set -g window-status-current-format "#[bg=#005eff,fg=#ffffff,bold] #I:#W "

# Right status: Empty (Minimalist)
set -g status-right ""

# --- NAVIGATION ---
# Use Vi keys in copy mode
setw -g mode-keys vi
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi y send -X copy-selection-and-cancel

# Navigation between panes (if user splits inside tmux, though we prefer Ghostty splits)
# When inside Neovim, pass Ctrl+B h/j/k/l through for Neovim pane jumps.
bind-key h if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b h" "select-pane -L"
bind-key j if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b j" "select-pane -D"
bind-key k if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b k" "select-pane -U"
bind-key l if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b l" "select-pane -R"

# --- KEYBINDINGS ---
# Unbind defaults that conflict with our new setup
unbind t    # Default: clock
unbind w    # Default: choose-window

# When inside Neovim, pass Cmd+T / Cmd+1..9 through for toggleterm tabs.
# Keep the match inline (avoid nested format expansion gotchas).

# New window (tab) unless in Neovim (then pass through)
# Always start new windows at #{HOME} (don't inherit current pane cwd).
bind-key t if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b t" "new-window -c #{HOME}"

# Window switching unless in Neovim (then pass through)
bind-key 1 if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b 1" "select-window -t :1"
bind-key 2 if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b 2" "select-window -t :2"
bind-key 3 if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b 3" "select-window -t :3"
bind-key 4 if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b 4" "select-window -t :4"
bind-key 5 if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b 5" "select-window -t :5"
bind-key 6 if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b 6" "select-window -t :6"
bind-key 7 if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b 7" "select-window -t :7"
bind-key 8 if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b 8" "select-window -t :8"
bind-key 9 if-shell -F "#{||:#{==:#{@pane_is_nvim},1},#{||:#{==:#{pane_current_command},nvim},#{==:#{pane_current_command},vim}}}" "send-keys C-b 9" "select-window -t :9"

# Close window (tab)
bind d kill-window
# Close entire session (pane)
bind w kill-session

# CTRL+D is handled by Ghostty (close surface) to keep undo working

# Global (no-prefix) Clear Screen: CTRL+/ (which often sends C-_)
bind-key -n C-_ send-keys C-l

# --- PLUGINS ---
set -g @plugin 'tmux-plugins/tpm'

# Ghostty spawns lots of short-lived tmux servers; TPM adds noticeable cold-start
# cost there, so the Ghostty launcher sets TMUX_SKIP_TPM=1.
if-shell '[ -z "$TMUX_SKIP_TPM" ]' "run '~/.tmux/plugins/tpm/tpm'"
